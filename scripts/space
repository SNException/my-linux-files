#!/usr/bin/env bash

#
# Displays the current disk space of the root directory.
# - Niklas Schultz
#

dir=$1
if [ -z "$dir" ]; then
    # If no argument is provided we set root directory
    dir="/"
fi

mountpoint -q $dir
if [ $? -ne 0 ]; then
    echo "The given argument does not point to a mountpoint."
    echo "The script will terminate"
    exit 1
fi

RESET='\033[0;0m'
BOLD='\033[0;1m'
GREEN='\033[0;32m'
GRAY='\033[0;90m'

used=$(df $dir | awk 'FNR == 2 {print}' | awk '{print $3}')
free=$(df $dir | awk 'FNR == 2 {print}' | awk '{print $2}')
current_percentage=$(awk -v var1=$used -v var2=$free 'BEGIN {print (var1/var2)*100}' | cut -d'.' -f1)
current_percentage2=$(awk -v var1=$current_percentage -v var2=2 'BEGIN {print (var1/var2)}' | cut -d'.' -f1)

result1=$(df $dir -h | awk 'FNR == 2 {print}' | awk '{print $3}')
result2=$(df $dir -h | awk 'FNR == 2 {print}' | awk '{print $2}')
echo $result1 "/" $result2 "("$current_percentage"%)"

printf "${BOLD}[${RESET}"
for i in $(seq 50); do
   if ((i <= $current_percentage2))
   then
       printf "${GREEN}|${RESET}"
   else
       printf "${GRAY}|${RESET}"
   fi
done
printf "${BOLD}]${RESET}\n"
